<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Animation test</title>
	<style>
		div {
			background-color:#FF0000;
			width: 400px;
			height: 100px;
			position: absolute;
		}
		p {
			position: absolute;
			top: 50%;
			left: 50%;
			margin: 0;
			transform:translate(-50%,-50%);
		}
	</style>
</head>
<body>
	<script>
		var board = [];
		var MAX_VELOCITY = 400;
		var ACCELERATION = 0.02;
		var TILE_WIDTH = 100;
		var TILE_SPACING = 10;
		
		function School(schoolName, yPosition, rank){
			this.name = schoolName;
			this.score = 0;
			this.rank = rank;
			this.y = yPosition;
			this.velocity = 0;
			this.acceleration = 0;
			this.direction = 0;
			this.move = function(endPosition, endRank){
				this.direction = Math.sign(endRank - this.rank);
				if (Math.abs(endPosition - this.y) <= (Math.abs(endPosition - this.rank*(TILE_SPACING+TILE_WIDTH))/2)){
					this.acceleration = (0 - this.velocity*this.velocity)/(2*(endPosition - this.y));
				} else {
					this.acceleration = ACCELERATION * Math.sign(endPosition - this.y);
				}
				if (Math.abs(endPosition - this.y) < 5 && Math.abs(this.velocity) < 0.01){
					this.acceleration = 0;
				}
				this.velocity += this.acceleration;
				if (Math.abs(this.velocity) >= MAX_VELOCITY){
					this.y += MAX_VELOCITY*this.direction;
				} else {
					this.y += this.velocity;
				}
				if (Math.sign(endPosition - this.y) == -this.direction){
					this.y = endPosition;
					this.rank = endRank;
					this.velocity = 0;
					this.acceleration = 0;
					this.direction = 0;
				}
				document.getElementById(this.name).style.top = this.y + "px";
			}
		}
		
		var schools = ["BFH","WHF","FRH","SAL","CLB","ABC","DEF","GHI","JKL"];
		
		function sortTiles(tileA, tileB){
			return tileB.score - tileA.score;
		}
		
		function moveTiles(){
			board = board.sort(sortTiles);
			for (var i = 0; i < board.length; i++){
				board[i].move(i*(TILE_SPACING+TILE_WIDTH), i);
			}
			window.requestAnimationFrame(moveTiles);
		}
		
		function createBoardTiles(tileNameList){
			var body = document.getElementsByTagName("body")[0];
			for (var i = 0; i < tileNameList.length; i++){
				board.push(new School(tileNameList[i], (TILE_SPACING+TILE_WIDTH)*i, i));
				var divElement = document.createElement("div")
				divElement.id = tileNameList[i];
				divElement.style.top = ((TILE_SPACING+TILE_WIDTH)*i)+"px";
				var pElement = document.createElement("p");
				var node = document.createTextNode(tileNameList[i]);
				pElement.appendChild(node);
				divElement.appendChild(pElement);
				body.appendChild(divElement);
			}
		}
		createBoardTiles(schools);
		window.requestAnimationFrame(moveTiles);
	</script>
<body>
</html>
